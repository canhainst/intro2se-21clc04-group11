<script>

    const itemsPerPage = 15;
    let currentPage = 1;

    function fetchAndDisplayProducts() {
        fetch('http://localhost:5000/warehouse/all')
            .then(response => response.json())
            .then(products => {
                document.querySelector('.container').innerHTML = '';

                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;

                // Hiển thị sản phẩm mới
                products.slice(startIndex, endIndex).forEach(product => {
                    const productElement = document.createElement('div');
                    productElement.classList.add('product', 'row', 'd-flex', 'align-items-center');
                    productElement.innerHTML = `
            <div class="col-5 d-flex">
                <img src="${product.Photo}">
                <span class="Bookname">${product.ProductName}</span>
            </div>
            <div class="col-2 text-center">
                <span class="ptitle">INSTOCK</span>
                <div class="stock">${product.Quantity}</div>
            </div>
            <div class="col-3 text-center">
                <p class="ptitle">IMPORT PRICE</p>
                <span class="ptitle">${product.PriceIn} VND</span>
            </div>
            <div class="col-2 button" style="display: flex; flex-direction: column;">
    <button onclick="exportProduct('${product.ProductID}')">
        <i class="far fa-paper-plane"></i>
    </button>
     <button onclick="editProduct('${product.ProductID}')"><i class="fas fa-pencil-alt"></i></button>
   <button onclick="deleteProduct('${product.ProductID}')"><i class="far fa-trash-alt"></i></button>
</div>
            <div>
                
  <div class="pageInfo">
    <span>Showing ${(currentPage - 1) * itemsPerPage + 1} - ${(currentPage - 1) * itemsPerPage + itemsPerPage} results of </span>
    <span>298</span>
  </div>
  <!-- Nút chuyển trang -->
  <div class="pagebutton d-flex align-items-center">
    <button class="page" onclick="changePage('prev')"><i class="fas fa-chevron-left"></i></button>
    <div class="dropdown">
      <button class="btn btn-secondary dropdown-toggle no-border"
        style="background-color: white; color: black;" type="button" data-bs-toggle="dropdown"
        aria-expanded="false">
        Page ${currentPage}
      </button>
    </div>
    <button class="page" onclick="changePage('next')"><i class="fas fa-chevron-right"></i></button>
  </div>
          `;

                    document.querySelector('.container').appendChild(productElement);
                });
            })
            .catch(error => console.error('Error fetching data:', error));
    }

    function changePage(direction) {
        if (direction === 'prev') {
            currentPage = Math.max(1, currentPage - 1);
        } else {
            currentPage += 1;
        }

        fetchAndDisplayProducts();
    }

    document.addEventListener('DOMContentLoaded', function () {
        fetchAndDisplayProducts();
    });

    function exportProduct(productID) {
        fetch(`http://localhost:5000/warehouse/exportProduct?productID=${productID}`, {
            method: 'PUT'
        })
            .then(response => response.json())
            .then(result => {
                console.log('Export result:', result);
                alert('Export successful');
                fetchAndDisplayProducts();

            })
            .catch(error => {
                console.error('Error exporting product:', error);
                alert('Export failed');
                 });
    }

function deleteProduct(productID) {
        if (confirm('Are you sure you want to delete this product?')) {
            fetch(`http://localhost:5000/warehouse/deleteProduct?productID=${productID}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(result => {
                console.log('Delete result:', result);
                alert('Product deleted successfully');
                fetchAndDisplayProducts();
            })
            .catch(error => {
                console.error('Error deleting product:', error);
                alert('Failed to delete product');
            });
        }
    }
    function editProduct(productID) {
    window.location.href = `warehouse/edit?productID=${productID}`;
}

const searchInput = document.querySelector('.col-5 input');
const searchButton = document.querySelector('.col-5 button');
searchButton.addEventListener('click', function () {
    const searchValue = searchInput.value;
    fetchAndDisplayProducts({ search: searchValue });
});

// Đoạn mã xử lý filter và sorted
const filterDropdown = document.querySelector('.col-2 .dropdown');
const sortedDropdown = document.querySelector('.col-2:last-child .dropdown');

filterDropdown.addEventListener('click', function () {
    const filterValue = filterDropdown.querySelector('.dropdown-toggle').textContent.trim();
    // Gọi hàm fetchAndDisplayProducts với tham số filter
    fetchAndDisplayProducts({ filter: filterValue });
});

sortedDropdown.addEventListener('click', function () {
    const sortedValue = sortedDropdown.querySelector('.dropdown-toggle').textContent.trim();
    console.log(sortedValue);
    fetchAndDisplayProducts({ sort: sortedValue });
});


</script>


<div class="row">
    <div class="col-3" style="padding: 0;">
        <div class="sidebar">
            <div class="box_logo d-flex align-items-center">
                <div class="logo col-3">
                    <i class="far fa-user"
                        style="padding: 0 1em; scale: 9%; margin-bottom: 45px; margin-left: 20px;"></i>
                </div>
                <div class="admin col-8">
                    <ul>
                        <li class="d-flex align-items-center">
                            <span style="font-size: 24px; font-weight: 500;">ADMIN</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="nav">
                <ul>
                    <li>
                        <i class="fas fa-columns"></i>
                        <a href="Dashboard.html">DASHBOARD</a>
                    </li>
                    <li style="background-color: #ffb9a4;">
                        <i class="fas fa-warehouse"></i>
                        <a href="Warehouse.html">WAREHOUSE</a>
                    </li>
                    <li>
                        <i class="fas fa-cart-arrow-down"></i>
                        <a href="AddProduct.html">ADD PRODUCTS</a>
                    </li>
                    <li>
                        <i class="fas fa-store"></i>
                        <a href="Order">ORDERS</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-9" style="padding: 0;">
        <div class="content">
            <div class="title">
                <span style="margin-left: 45px;">Warehouse</span>
                <a href="AddProduct.html">+ Add new book</a>
            </div>
            <div class="row d-flex align-items-center">
                <div class="col-5 d-flex" style="padding: 20px 0 20px 50px;">
                    <input type="text" class="form-control border border-dark border-end-0" placeholder="Search"
                        aria-describedby="button-addon">
                    <button style="width: 40px;" class="btn btn-outline-secondary border border-dark border-start-0"
                        type="button" id="button-addon"><i class="fas fa-search"></i></button>
                </div>
                <div class="col-2"></div>
                <div class="col-2 d-flex align-items-center">
                    <span>Filter: </span>
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle"
                            style="background-color: white; color: black; border: 0;" type="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Option
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Sách Content</a></li>
                            <li><a class="dropdown-item" href="#">Sách Trinh Thám</a></li>
                            <li><a class="dropdown-item" href="#">Sách Kinh Doanh</a></li>
                            <li><a class="dropdown-item" href="#">Sách Tình Yêu</a></li>
                            <li><a class="dropdown-item" href="#">Sách Người lớn</a></li>
                            <li><a class="dropdown-item" href="#">Sách Trẻ em</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-2 d-flex align-items-center">
                    <span>Sorted: </span>
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle"
                            style="background-color: white; color: black; border: 0;" type="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Option
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Price low to high</a></li>
                            <li><a class="dropdown-item" href="#">Price high to low</a></li>
                            <li><a class="dropdown-item" href="#">In stock low to high</a></li>
                            <li><a class="dropdown-item" href="#">In stock high to low</a></li>
                            <li><a class="dropdown-item" href="#">Name A to Z</a></li>
                            <li><a class="dropdown-item" href="#">Name Z to A</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="container">
            </div>
        </div>

    </div>
</div>